{% extends super_template|default:"admin/base.html" %}
{% load staticfiles %}
{% load bootstrap %}
{% load app_filters %}
{% block breadcrumbs_class %}administracao{% endblock %}
{% block breadcrumbs %}
    <a href="/">Início <i class="fa fa-angle-right"></i></a>
    <a href="/base/ver_pregoes/">Licitações<i class="fa fa-angle-right"></i></a>
    <a href="javascript:void(0);">{{ title }}</a>
{% endblock %}

{% block extrastyle %}
    <style>
			/** Start: to style navigation tab **/
			.nav {
			  margin-bottom: 18px;
			  margin-left: 0;
			  list-style: none;
			}

			.nav > li > a {
			  display: block;
			}

			.nav-tabs{
			  *zoom: 1;
			}

			.nav-tabs:before,
			.nav-tabs:after {
			  display: table;
			  content: "";
			}

			.nav-tabs:after {
			  clear: both;
			}

			.nav-tabs > li {
			  float: left;
			}

			.nav-tabs > li > a {
			  padding-right: 12px;
			  padding-left: 12px;
			  margin-right: 2px;
			  line-height: 14px;
			}

			.nav-tabs {
			  border-bottom: 1px solid #ddd;
			}

			.nav-tabs > li {
			  margin-bottom: -1px;
			}

			.nav-tabs > li > a {
			  padding-top: 8px;
			  padding-bottom: 8px;
			  line-height: 18px;
			  border: 1px solid transparent;
			  -webkit-border-radius: 4px 4px 0 0;
				 -moz-border-radius: 4px 4px 0 0;
					  border-radius: 4px 4px 0 0;
			}

			.nav-tabs > li > a:hover {
			  border-color: #eeeeee #eeeeee #dddddd;
			}

			.nav-tabs > .active > a,
			.nav-tabs > .active > a:hover {
			  color: #555555;
			  cursor: default;
			  background-color: #ffffff;
			  border: 1px solid #ddd;
			  border-bottom-color: transparent;
			}

			li {
			  line-height: 18px;
			}

			.tab-content.active{
				display: block;
			}

			.tab-content.hide{
				display: none;
			}


			/** End: to style navigation tab **/


		</style>
{% endblock %}

{% block extrajs %}
    <script>
        function submeter_form(campo) {
            window.location = window.location.pathname + "?participante=" + escape( $('#'+campo.id).val()) + "#classificacao";

        }
        $(function () {
            var hash = window.location.hash;
            hash && $('ul.nav a[href="' + hash + '"]').tab('show');
        });

        $(document).ready(function() {
            $('.nav-tabs > li > a').click(function(event){
                event.preventDefault();//stop browser to take action for clicked anchor

                //get displaying tab content jQuery selector
                var active_tab_selector = $('.nav-tabs > li.active > a').attr('href');

                //find actived navigation and remove 'active' css
                var actived_nav = $('.nav-tabs > li.active');
                actived_nav.removeClass('active');

                //add 'active' css into clicked navigation
                $(this).parents('li').addClass('active');

                //hide displaying tab content
                $(active_tab_selector).removeClass('active');
                $(active_tab_selector).addClass('hide');

                //show target tab content
                var target_tab_selector = $(this).attr('href');
                $(target_tab_selector).removeClass('hide');
                $(target_tab_selector).addClass('active');
            });


            $('#atas > h3').click(function(event){
                event.preventDefault();//stop browser to take action for clicked anchor
                if ($('#atas').hasClass( "hideInfo")){
                    $('#atas').removeClass('hideInfo');
                }
                else {
                    $('#atas').addClass('hideInfo');
                }
            });

            $('#contratos > h3').click(function(event){
                event.preventDefault();//stop browser to take action for clicked anchor
                if ($('#contratos').hasClass( "hideInfo")){
                    $('#contratos').removeClass('hideInfo');
                }
                else {
                    $('#contratos').addClass('hideInfo');
                }
            });
            $('#classificacao > h3').click(function(event){
                event.preventDefault();//stop browser to take action for clicked anchor
                if ($('#classificacao').hasClass( "hideInfo")){
                    $('#classificacao').removeClass('hideInfo');
                }
                else {
                    $('#classificacao').addClass('hideInfo');
                }
            });


        });


	</script>
{% endblock %}


{% block content %}


    <div>

        <ul class="nav nav-tabs">

            <li class="active">
                <a data-toggle="tab" href="#contratos">Meus Contratos</a>
            </li>
            <li>
                <a data-toggle="tab" href="#atas">Minhas Atas</a>
            </li>



        </ul>
    </div>
    <div class="tab-content">
            <div id="contratos" class="tab-pane in active">
                <div class="pull-right">
                {% if pregao.eh_ativo and pregao.tem_item_sem_lote %}
                    <a class="btn btn-success" href="/base/criar_lote/{{ pregao.pk }}/">Criar Lote</a>
                {% endif %}
                <br><br>
            </div>
                {% if lotes.exists %}

                    {% for lote in lotes %}
                        <h3>Lote {{ lote.item }}</h3>
                        <table class="table table-bordered table-condensed table-striped">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Material</th>
                                    <th>Valor</th>
                                </tr>
                            </thead>
                            <tbody>
                                {%  for item in lote.lote.all %}
                                    <tr>

                                        <td>{{ item.lote.item }}.{{item.numero_item}}</td>
                                        <td>{{ item.item.material}}</td>
                                         <td>{{ item.item.valor_medio }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% endfor %}

                {% else %}
                    <br><br>
                    <p class="alert alert-warning">Nenhum contrato cadastrado.</p>
                {% endif %}
            </div>

       <div id="atas" class="tab-pane">


            <div class="pull-right">
                {% if pregao.eh_ativo %}
                    <a class="btn btn-primary" href="/base/cadastra_participante_pregao/{{ pregao.pk }}/">Adicionar Participante</a>
                    <a class="btn btn-warning" href="/base/encerrar_pregao/{{ pregao.pk }}/1/">Deserto</a>
                    <a class="btn btn-danger" href="/base/encerrar_pregao/{{ pregao.pk }}/2/">Fracassado</a>
                {% endif %}
                <br><br>
            </div>

                {%  if solicitacoes.exists %}
                    <table class="table table-bordered table-condensed table-striped">
                        <thead>
                            <tr>
                                <th>Atas de Registro de Preços</th>

                            </tr>
                        </thead>
                        <tbody>
                            {%  for solicitacao in solicitacoes %}
                                <tr>

                                    <td>
                                        <a data-toggle="collapse" data-target="#demo{{solicitacao.id}}">ARP - {{ solicitacao.get_pregao.num_pregao }}</a>

                                        <div id="demo{{solicitacao.id}}" class="collapse">
                                            <form action="." method="post" class="form-horizontal" enctype="multipart/form-data">
                                                {% csrf_token %}
                                                <input type="hidden" id='solicitacao_escolhida' name="solicitacao_escolhida" value="{{solicitacao.id}}">
                                                <br>
                                                <table width="30%" align="right" class="table table-bordered table-condensed table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>Item</th>
                                                            <th>Marca</th>
                                                            <th>Empresa</th>
                                                            <th>Valor</th>
                                                            <th>Quantidade Disponível</th>
                                                            <th>Quantidade Solicitada</th>

                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for resultado in solicitacao.get_resultado %}
                                                            <tr>
                                                                <td>{{ resultado.item }}</td>
                                                                <td>{{ resultado.marca }}</td>
                                                                <td>{{ resultado.participante }}</td>
                                                                <td>{{ resultado.valor }}</td>
                                                                <td>{{ resultado.item.get_quantidade_disponivel }}</td>
                                                                <td><input name="quantidades" value="0"></td>

                                                            </tr>

                                                        {% endfor %}
                                                        <tr>
                                                           <td  colspan="5">&nbsp;</td>
                                                           <td><button type="submit" class="btn btn-primary">Solicitar</button></td>
                                                        </tr>
                                                    </tbody>
                                               </table>

                                            </form>
                                        </div>


                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p class="alert alert-warning">Nenhuma ata cadastrada.</p>
                {% endif %}


        </div>




    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <div class="modal-content">
                <!-- Content will be loaded here from "remote.php" file -->
            </div>



        </div>
    </div>

{% endblock %}