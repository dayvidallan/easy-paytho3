{% extends super_template|default:"admin/base.html" %}
{% load staticfiles %}
{% load bootstrap %}
{% block breadcrumbs_class %}administracao{% endblock %}
{% block breadcrumbs %}
    <a href="/">Início <i class="fa fa-angle-right"></i></a>
    <a href="/base/ver_solicitacoes/">Solicitações <i class="fa fa-angle-right"></i></a>
    <a href="/base/itens_solicitacao/{{solicitacao.id}}/">Solicitação {{solicitacao}} <i class="fa fa-angle-right"></i></a>
    <a href="javascript:void(0);">{{ title }}</a>
{% endblock %}

{% block content %}

        <div class="pull-right">
            {% if tem_pendente %}
                <a class="btn btn-success" href="/base/aprovar_todos_pedidos/{{item.pk}}/">Aprovar Todos</a>
            {% endif %}
            <a class="btn btn-primary" href="/base/itens_solicitacao/{{item.solicitacao.pk}}/">Voltar</a>
            <br><br>
        </div>

        {% if pedidos.exists %}
            <table class="table table-bordered table-condensed table-striped">
                <thead>
                    <tr>
                        <th>Secretaria</th>
                        <th>Quantidade</th>
                        <th>Aceito</th>
                        <th>Avaliado Em</th>
                        <th>Avaliado Por</th>
                        <th>Opções</th>

                    </tr>
                </thead>
                <tbody>
                    {% for pedido in pedidos %}
                       <tr>

                           <td>{{ pedido.secretaria }}</td>
                           <td>{{ pedido.quantidade }}</td>
                           <td>
                               {% if pedido.avaliado_em %}
                                   {% if pedido.aprovado %}
                                       <font color="green">Sim</font>
                                   {% else %}
                                       <font color="red">Não</font> ({{ pedido.justificativa_reprovacao }})
                                   {% endif %}
                               {% else %}
                                -
                               {% endif %}
                            </td>
                           <td>{{ pedido.avaliado_em|default_if_none:'-' }}</td>
                           <td>{{ pedido.avaliado_por|default_if_none:'-' }}</td>
                           <td>{% if not pedido.avaliado_em and pode_avaliar %}
                                   <a class="btn btn-success" href="/base/pedido_outro_interessado/{{ pedido.pk }}/1/">Aprovar Pedido</a>
                                   <a class="btn btn-danger" href="/base/pedido_outro_interessado/{{ pedido.pk }}/2/">Rejeitar Pedido</a>
                               {% endif %}
                               {% if request.user.pessoafisica.setor.secretaria in solicitacao.interessados.all and request.user.pessoafisica.setor.secretaria == pedido.secretaria and solicitacao.dentro_prazo_resposta %}
                                    <a class="btn btn-default" href="/base/editar_pedido/{{ pedido.pk }}/">Editar Pedido</a>
                               {% endif %}

                           </td>
                       </tr>
                    {% endfor %}
                    <tr>
                        <td>Total</td>
                        <td>{{ total.total }}</td>
                    </tr>
                </tbody>
            </table>
        {% else %}
            <p class="alert alert-warning">Nenhum pedido cadastrado.</p>
        {% endif %}

{% endblock %}